<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1rw2s84" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.5.0">
  <bpmn:collaboration id="Collaboration_03e96t9">
    <bpmn:extensionElements>
      <camunda:properties>
        <camunda:property />
      </camunda:properties>
    </bpmn:extensionElements>
    <bpmn:participant id="Participant_04mv8eg" name="Mobility On Demand" processRef="Mobility_On_Demand" />
    <bpmn:participant id="Participant_0qzdmtk" name="Customer" />
    <bpmn:messageFlow id="MessageFlow_03ynrem" name="Order" sourceRef="Participant_0qzdmtk" targetRef="StartEvent_189kevz" />
    <bpmn:messageFlow id="MessageFlow_1voghhu" name="Cancellation" sourceRef="Task_119g0uu" targetRef="Participant_0qzdmtk" />
    <bpmn:messageFlow id="MessageFlow_13kh2dy" name="Notification" sourceRef="Task_1v65ro1" targetRef="Participant_0qzdmtk" />
  </bpmn:collaboration>
  <bpmn:message id="Message_1xqh2cl" name="new_order" />
  <bpmn:message id="Message_18icw6u" name="new_target" />
  <bpmn:message id="Message_027rgcb" name="bank_transfare" />
  <bpmn:message id="Message_18zvkt7" name="new_feedback" />
  <bpmn:message id="Message_1obzhat" name="taxi_finished" />
  <bpmn:message id="Message_131k57m" name="taxi_starts" />
  <bpmn:process id="Mobility_On_Demand" name="Mobility On Demand" isExecutable="true">
    <bpmn:laneSet id="LaneSet_054bwan">
      <bpmn:lane id="Lane_1oyb7m6" name="Trip Data Management">
        <bpmn:flowNodeRef>Task_1sxkvas</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_1n234m5</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_0fq07gy" name="Route Guidance">
        <bpmn:flowNodeRef>ServiceTask_15rcueg</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_0pv3dkf</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>BoundaryEvent_1wh27dx</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_0w7mkl1" name="Finance">
        <bpmn:flowNodeRef>EndEvent_02pbgyo</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_0uuqleu</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_1xgdwlq" name="Order Management">
        <bpmn:flowNodeRef>Task_1v65ro1</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_119g0uu</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>StartEvent_189kevz</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_0bntot5</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    <bpmn:dataStoreReference id="DataStoreReference_0gzwpwx" name="Trip Data DB" />
    <bpmn:serviceTask id="Task_1sxkvas" name="Store Order in DB" camunda:expression="${tripDataService.createTrip(execution)}">
      <bpmn:incoming>SequenceFlow_06zwlts</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_05p8fx1</bpmn:outgoing>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_1oqvnht">
        <bpmn:targetRef>DataObjectReference_15w39s9</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_0pdjvfe">
        <bpmn:targetRef>DataStoreReference_0gzwpwx</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Task_1n234m5" name="Mark Order Cancelled" camunda:expression="${tripDataService.abortTrip(execution)}">
      <bpmn:incoming>SequenceFlow_1x24jj6</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0o8s8b4</bpmn:outgoing>
      <bpmn:property id="Property_1jnlyzz" name="__targetRef_placeholder" />
      <bpmn:dataOutputAssociation id="DataOutputAssociation_1i2glpn">
        <bpmn:targetRef>DataStoreReference_0gzwpwx</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:sendTask id="Task_1v65ro1" name="Notify Customer" camunda:class="edu.thi.mobilityondemand.servicetask.SendConfirmationToCustomer">
      <bpmn:incoming>SequenceFlow_0l5ocea</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_119sp5l</bpmn:outgoing>
    </bpmn:sendTask>
    <bpmn:sendTask id="Task_119g0uu" name="Send Cancellation" camunda:class="edu.thi.mobilityondemand.servicetask.SendCancellationToCustomer">
      <bpmn:incoming>SequenceFlow_0o8s8b4</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0vbuxc9</bpmn:outgoing>
    </bpmn:sendTask>
    <bpmn:startEvent id="StartEvent_189kevz" name="Receiving Order">
      <bpmn:outgoing>SequenceFlow_06zwlts</bpmn:outgoing>
      <bpmn:messageEventDefinition messageRef="Message_1xqh2cl" />
    </bpmn:startEvent>
    <bpmn:serviceTask id="ServiceTask_15rcueg" name="Calculate route" camunda:class="edu.thi.mobilityondemand.servicetask.CalculateRoute">
      <bpmn:incoming>SequenceFlow_05p8fx1</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0l5ocea</bpmn:outgoing>
      <bpmn:property id="Property_1dkm0ds" name="__targetRef_placeholder" />
      <bpmn:dataInputAssociation id="DataInputAssociation_0m5g755">
        <bpmn:sourceRef>DataObjectReference_15w39s9</bpmn:sourceRef>
        <bpmn:targetRef>Property_1dkm0ds</bpmn:targetRef>
      </bpmn:dataInputAssociation>
      <bpmn:dataOutputAssociation id="DataOutputAssociation_1pomk0x">
        <bpmn:targetRef>DataObjectReference_15w39s9</bpmn:targetRef>
      </bpmn:dataOutputAssociation>
    </bpmn:serviceTask>
    <bpmn:endEvent id="EndEvent_0bntot5" name="Trip aborted">
      <bpmn:incoming>SequenceFlow_0vbuxc9</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:endEvent id="EndEvent_02pbgyo" name="Trip Finished">
      <bpmn:incoming>SequenceFlow_0yclayf</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1kb2mkr" messageRef="Message_1tnjbsk" />
    </bpmn:endEvent>
    <bpmn:callActivity id="Task_0pv3dkf" name="Performing Trip" calledElement="Performe_Trip">
      <bpmn:extensionElements>
        <camunda:in variables="all" />
        <camunda:out variables="all" />
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_119sp5l</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0u8qoiu</bpmn:outgoing>
      <bpmn:property id="Property_1i1fmo9" name="__targetRef_placeholder" />
      <bpmn:dataInputAssociation id="DataInputAssociation_18hc39o">
        <bpmn:sourceRef>DataObjectReference_15w39s9</bpmn:sourceRef>
        <bpmn:targetRef>Property_1i1fmo9</bpmn:targetRef>
      </bpmn:dataInputAssociation>
    </bpmn:callActivity>
    <bpmn:dataObjectReference id="DataObjectReference_15w39s9" name="Trip data" dataObjectRef="DataObject_1wcz5gk" />
    <bpmn:dataObject id="DataObject_1wcz5gk" />
    <bpmn:callActivity id="Task_0uuqleu" name="Payment" calledElement="process_payment">
      <bpmn:extensionElements>
        <camunda:in variables="all" />
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0u8qoiu</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0yclayf</bpmn:outgoing>
      <bpmn:property id="Property_13fw6bh" name="__targetRef_placeholder" />
      <bpmn:dataInputAssociation id="DataInputAssociation_0urnhqn">
        <bpmn:sourceRef>DataObjectReference_15w39s9</bpmn:sourceRef>
        <bpmn:targetRef>Property_13fw6bh</bpmn:targetRef>
      </bpmn:dataInputAssociation>
    </bpmn:callActivity>
    <bpmn:boundaryEvent id="BoundaryEvent_1wh27dx" name="Route not found" attachedToRef="ServiceTask_15rcueg">
      <bpmn:outgoing>SequenceFlow_1x24jj6</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_0verpsh" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="SequenceFlow_1x24jj6" sourceRef="BoundaryEvent_1wh27dx" targetRef="Task_1n234m5" />
    <bpmn:sequenceFlow id="SequenceFlow_0l5ocea" sourceRef="ServiceTask_15rcueg" targetRef="Task_1v65ro1" />
    <bpmn:sequenceFlow id="SequenceFlow_05p8fx1" sourceRef="Task_1sxkvas" targetRef="ServiceTask_15rcueg" />
    <bpmn:sequenceFlow id="SequenceFlow_0vbuxc9" sourceRef="Task_119g0uu" targetRef="EndEvent_0bntot5" />
    <bpmn:sequenceFlow id="SequenceFlow_0u8qoiu" sourceRef="Task_0pv3dkf" targetRef="Task_0uuqleu" />
    <bpmn:sequenceFlow id="SequenceFlow_06zwlts" sourceRef="StartEvent_189kevz" targetRef="Task_1sxkvas" />
    <bpmn:sequenceFlow id="SequenceFlow_0yclayf" sourceRef="Task_0uuqleu" targetRef="EndEvent_02pbgyo" />
    <bpmn:sequenceFlow id="SequenceFlow_0o8s8b4" sourceRef="Task_1n234m5" targetRef="Task_119g0uu" />
    <bpmn:sequenceFlow id="SequenceFlow_119sp5l" sourceRef="Task_1v65ro1" targetRef="Task_0pv3dkf" />
  </bpmn:process>
  <bpmn:message id="Message_1tnjbsk" name="trip_finished" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_03e96t9">
      <bpmndi:BPMNShape id="Participant_04mv8eg_di" bpmnElement="Participant_04mv8eg" isHorizontal="true">
        <dc:Bounds x="165" y="194" width="1260" height="630" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0w7mkl1_di" bpmnElement="Lane_0w7mkl1" isHorizontal="true">
        <dc:Bounds x="195" y="535" width="1230" height="110" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_1xgdwlq_di" bpmnElement="Lane_1xgdwlq" isHorizontal="true">
        <dc:Bounds x="195" y="194" width="1230" height="191" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0fq07gy_di" bpmnElement="Lane_0fq07gy" isHorizontal="true">
        <dc:Bounds x="195" y="645" width="1230" height="179" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Participant_0qzdmtk_di" bpmnElement="Participant_0qzdmtk" isHorizontal="true">
        <dc:Bounds x="165" y="80" width="1260" height="60" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="StartEvent_0gizaxt_di" bpmnElement="StartEvent_189kevz">
        <dc:Bounds x="267" y="267" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="246" y="310" width="81" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="MessageFlow_03ynrem_di" bpmnElement="MessageFlow_03ynrem">
        <di:waypoint x="285" y="140" />
        <di:waypoint x="285" y="267" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="250" y="163" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_10qd2ec_di" bpmnElement="Task_1sxkvas">
        <dc:Bounds x="405" y="401" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_1oyb7m6_di" bpmnElement="Lane_1oyb7m6" isHorizontal="true">
        <dc:Bounds x="195" y="385" width="1230" height="150" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="SendTask_0vvupjp_di" bpmnElement="Task_1v65ro1">
        <dc:Bounds x="695" y="285" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="SendTask_1dd8lf1_di" bpmnElement="Task_119g0uu">
        <dc:Bounds x="915" y="214" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="MessageFlow_1voghhu_di" bpmnElement="MessageFlow_1voghhu">
        <di:waypoint x="965" y="214" />
        <di:waypoint x="965" y="140" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="900" y="163" width="61" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="MessageFlow_13kh2dy_di" bpmnElement="MessageFlow_13kh2dy">
        <di:waypoint x="745" y="285" />
        <di:waypoint x="745" y="140" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="685" y="163" width="55" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_119sp5l_di" bpmnElement="SequenceFlow_119sp5l">
        <di:waypoint x="795" y="325" />
        <di:waypoint x="890" y="325" />
        <di:waypoint x="890" y="746" />
        <di:waypoint x="915" y="746" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_049g512_di" bpmnElement="Task_1n234m5">
        <dc:Bounds x="725" y="431" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0o8s8b4_di" bpmnElement="SequenceFlow_0o8s8b4">
        <di:waypoint x="825" y="471" />
        <di:waypoint x="845" y="471" />
        <di:waypoint x="845" y="254" />
        <di:waypoint x="915" y="254" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0u8qoiu_di" bpmnElement="SequenceFlow_0u8qoiu">
        <di:waypoint x="1015" y="746" />
        <di:waypoint x="1040" y="746" />
        <di:waypoint x="1040" y="585" />
        <di:waypoint x="1065" y="585" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0yclayf_di" bpmnElement="SequenceFlow_0yclayf">
        <di:waypoint x="1165" y="585" />
        <di:waypoint x="1347" y="585" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_06zwlts_di" bpmnElement="SequenceFlow_06zwlts">
        <di:waypoint x="303" y="285" />
        <di:waypoint x="365" y="285" />
        <di:waypoint x="365" y="441" />
        <di:waypoint x="405" y="441" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="DataObjectReference_15w39s9_di" bpmnElement="DataObjectReference_15w39s9">
        <dc:Bounds x="587" y="446" width="36" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="584" y="422" width="42" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0vbuxc9_di" bpmnElement="SequenceFlow_0vbuxc9">
        <di:waypoint x="1015" y="254" />
        <di:waypoint x="1362" y="254" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_15rcueg_di" bpmnElement="ServiceTask_15rcueg">
        <dc:Bounds x="555" y="695" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BoundaryEvent_1wh27dx_di" bpmnElement="BoundaryEvent_1wh27dx">
        <dc:Bounds x="637" y="757" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="660" y="791" width="79" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_05p8fx1_di" bpmnElement="SequenceFlow_05p8fx1">
        <di:waypoint x="505" y="441" />
        <di:waypoint x="530" y="441" />
        <di:waypoint x="530" y="735" />
        <di:waypoint x="555" y="735" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0l5ocea_di" bpmnElement="SequenceFlow_0l5ocea">
        <di:waypoint x="655" y="735" />
        <di:waypoint x="675" y="735" />
        <di:waypoint x="675" y="325" />
        <di:waypoint x="695" y="325" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1x24jj6_di" bpmnElement="SequenceFlow_1x24jj6">
        <di:waypoint x="673" y="775" />
        <di:waypoint x="695" y="775" />
        <di:waypoint x="695" y="471" />
        <di:waypoint x="725" y="471" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_1tjuqj6_di" bpmnElement="EndEvent_0bntot5">
        <dc:Bounds x="1362" y="236" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1351" y="279" width="58" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_053oz78_di" bpmnElement="EndEvent_02pbgyo">
        <dc:Bounds x="1347" y="567" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1334" y="610" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="CallActivity_01m45xd_di" bpmnElement="Task_0pv3dkf">
        <dc:Bounds x="915" y="706" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="DataOutputAssociation_1oqvnht_di" bpmnElement="DataOutputAssociation_1oqvnht">
        <di:waypoint x="505" y="470" />
        <di:waypoint x="587" y="470" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataInputAssociation_0m5g755_di" bpmnElement="DataInputAssociation_0m5g755">
        <di:waypoint x="590" y="496" />
        <di:waypoint x="590" y="695" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_1pomk0x_di" bpmnElement="DataOutputAssociation_1pomk0x">
        <di:waypoint x="589" y="695" />
        <di:waypoint x="591" y="496" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataInputAssociation_0urnhqn_di" bpmnElement="DataInputAssociation_0urnhqn">
        <di:waypoint x="605" y="496" />
        <di:waypoint x="605" y="560" />
        <di:waypoint x="1065" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataInputAssociation_18hc39o_di" bpmnElement="DataInputAssociation_18hc39o">
        <di:waypoint x="620" y="496" />
        <di:waypoint x="620" y="660" />
        <di:waypoint x="960" y="660" />
        <di:waypoint x="960" y="706" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="CallActivity_1vg8cax_di" bpmnElement="Task_0uuqleu">
        <dc:Bounds x="1065" y="545" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_0gzwpwx_di" bpmnElement="DataStoreReference_0gzwpwx">
        <dc:Bounds x="580" y="885" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="574" y="942" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="DataOutputAssociation_0pdjvfe_di" bpmnElement="DataOutputAssociation_0pdjvfe">
        <di:waypoint x="455" y="481" />
        <di:waypoint x="455" y="905" />
        <di:waypoint x="580" y="905" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="DataOutputAssociation_1i2glpn_di" bpmnElement="DataOutputAssociation_1i2glpn">
        <di:waypoint x="775" y="511" />
        <di:waypoint x="775" y="915" />
        <di:waypoint x="630" y="915" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
